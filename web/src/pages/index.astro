---
import Layout from '@layouts/Layout.astro'

import { theme } from '../data/theme.js'

import CopyIcon from '@components/icons/copy.astro'

// Import Components Layout
import Footer from '@components/layout/Footer.astro'
import Header from '@components/layout/Header.astro'

// Import Section
import Preview from '@components/sections/Preview.astro'
import ScrollAnimation from '@components/sections/ScrollAnimation.astro'
import ScrollViewTimelines from '@components/sections/ScrollViewTimelines.astro'

const { animation, animationDuration, animationSteps, animationDelay } = theme

const POPULAR_ANIMATIONS = [
  'fade-in',
  'blurred-fade-in',
  'zoom-in',
  'slide-in-top',
  'bouncing',
  'pulsing',
  'shake',
  'tada',
  'jelly',
  'flip-horizontal',
  'swing',
  'wobble',
  'rotate-360',
  'fade-in-up',
  'slide-in-left',
  'zoom-out',
  'fade-in-down',
  'slide-in-bottom',
  'slide-in-right'
]

const sortedAnimations = Object.keys(animation).sort((a, b) => {
  const indexA = POPULAR_ANIMATIONS.indexOf(a)
  const indexB = POPULAR_ANIMATIONS.indexOf(b)

  if (indexA === -1 && indexB === -1) return a.localeCompare(b)
  if (indexA === -1) return 1
  if (indexB === -1) return -1
  return indexA - indexB
})
---

<Layout
  title='Tailwind CSS Animations Plugin: Community-Powered Animation Magic'
>
  <wc-toast class='pointer-events-none fixed inset-0 z-50'></wc-toast>
  <Header />

  <main class='mx-auto w-full max-w-6xl pt-16'>
    <Preview />

    <section id='animation-collection' class='mt-32 mb-24'>
      <div class='mb-16 flex flex-col items-center'>
        <h2
          class='animate-fade-in-up animate-delay-[600ms] mb-4 text-2xl font-bold tracking-tight text-slate-900 sm:text-4xl dark:text-white'
        >
          Animation Collection
        </h2>
        <p
          class='animate-fade-in-up animate-delay-700 max-w-2xl text-center text-lg text-balance text-slate-600 dark:text-slate-400'
        >
          Explore our comprehensive library of ready-to-use animations.
          Customize duration, delay, and timing to fit your needs with zero
          configuration.
        </p>
      </div>

      <div class='relative'>
        <section
          class='top-4 z-50 mb-12 flex items-center justify-center px-4'
          id='option-inputs'
        >
          <div
            class='animate-fade-in-up animate-delay-800 flex flex-wrap items-center justify-center gap-4 rounded-2xl border border-slate-200 bg-white/70 p-4 shadow-2xl backdrop-blur-xl dark:border-white/10 dark:bg-black/60'
          >
            <div class='flex flex-col gap-1'>
              <span
                class='text-[10px] font-bold tracking-wider text-slate-400 uppercase'
                >Duration</span
              >
              <select
                name='duration'
                id='duration'
                class='min-w-32 rounded-lg border border-slate-200 bg-slate-50/50 px-2 py-1 text-sm font-medium transition-colors outline-none hover:border-blue-500 dark:border-white/5 dark:bg-white/5'
              >
                {
                  Object.entries(animationDuration).map(([key, value]) => (
                    <option
                      value={value}
                      selected={key === '1000'}
                      class='dark:bg-slate-900'
                    >
                      {key}
                    </option>
                  ))
                }
              </select>
            </div>

            <div class='flex flex-col gap-1'>
              <span
                class='text-[10px] font-bold tracking-wider text-slate-400 uppercase'
                >Delay</span
              >
              <select
                name='delay'
                id='delay'
                class='min-w-32 rounded-lg border border-slate-200 bg-slate-50/50 px-2 py-1 text-sm font-medium transition-colors outline-none hover:border-blue-500 dark:border-white/5 dark:bg-white/5'
              >
                {
                  Object.entries(animationDelay).map(([key, value]) => (
                    <option value={value} class='dark:bg-slate-900'>
                      {key}
                    </option>
                  ))
                }
              </select>
            </div>

            <div class='flex flex-col gap-1'>
              <span
                class='text-[10px] font-bold tracking-wider text-slate-400 uppercase'
                >Steps</span
              >
              <select
                name='steps'
                id='steps'
                class='min-w-32 rounded-lg border border-slate-200 bg-slate-50/50 px-2 py-1 text-sm font-medium transition-colors outline-none hover:border-blue-500 dark:border-white/5 dark:bg-white/5'
              >
                {
                  Object.entries(animationSteps).map(([key, value]) => (
                    <option value={value} class='dark:bg-slate-900'>
                      {key}
                    </option>
                  ))
                }
              </select>
            </div>

            <div
              class='hidden h-8 w-px bg-slate-200 sm:block dark:bg-slate-800'
            >
            </div>

            <label class='group flex cursor-pointer items-center gap-3'>
              <span
                class='text-sm font-medium text-slate-600 transition-colors group-hover:text-blue-500 dark:text-slate-400'
                >Animate all</span
              >
              <div class='relative inline-flex h-6 w-11 items-center'>
                <input class='peer sr-only' id='animate' type='checkbox' />
                <div
                  class='h-6 w-11 rounded-full bg-slate-200 transition-colors peer-checked:bg-blue-500 dark:bg-slate-800'
                >
                </div>
                <div
                  class='absolute left-1 h-4 w-4 rounded-full bg-white shadow-sm transition-all peer-checked:translate-x-5'
                >
                </div>
              </div>
            </label>
          </div>
        </section>

        <section
          class='relative mx-auto grid max-w-6xl grid-cols-2 gap-6 px-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 lg:px-8'
        >
          {
            sortedAnimations.map((animationKey, index) => (
              <article
                class={`group animate-fade-in-up relative flex flex-col items-center gap-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-all hover:-translate-y-1 hover:border-blue-500 hover:shadow-xl hover:shadow-blue-500/10 dark:border-slate-800 dark:bg-slate-900/50 dark:hover:border-blue-500/50 ${index >= 15 ? 'hidden' : ''}`}
                data-class={animationKey}
                style={`animation-delay: ${1000 + index * 50}ms; animation-fill-mode: both;`}
              >
                <div class='flex w-full items-center justify-between'>
                  <span class='truncate pr-2 text-xs font-semibold text-slate-600 transition-colors group-hover:text-slate-900 dark:text-slate-400 dark:group-hover:text-white'>
                    {animationKey}
                  </span>
                  <button
                    aria-label={`Copy ${animationKey} class`}
                    class='text-slate-300 transition-colors hover:text-blue-500'
                  >
                    <CopyIcon class='size-4' />
                  </button>
                </div>

                <div class='flex flex-1 items-center justify-center py-8'>
                  <div
                    id={`preview-${animationKey}`}
                    class='size-16 rounded-xl bg-linear-to-br from-blue-500 to-blue-600 shadow-lg shadow-blue-500/30 transition-all duration-300 dark:from-blue-400 dark:to-blue-500 dark:shadow-blue-500/20'
                  />
                </div>
              </article>
            ))
          }
        </section>

        {
          sortedAnimations.length > 15 && (
            <div class='flex justify-center py-12'>
              <button
                id='load-more'
                class='animate-fade-in animate-delay-[1500ms] group flex cursor-pointer items-center gap-3 rounded-xl border border-slate-200 bg-white/50 px-10 py-3 text-sm font-bold text-slate-700 shadow-sm backdrop-blur-sm transition-all hover:border-blue-500 hover:text-blue-500 hover:shadow-md active:scale-95 dark:border-white/10 dark:bg-black/40 dark:text-slate-300 dark:hover:border-blue-500/50 dark:hover:text-blue-400'
              >
                <span>View all animations</span>
                <svg
                  xmlns='http://www.w3.org/2000/svg'
                  width='20'
                  height='20'
                  viewBox='0 0 24 24'
                  fill='none'
                  stroke='currentColor'
                  stroke-width='2.5'
                  stroke-linecap='round'
                  stroke-linejoin='round'
                  class='transition-transform group-hover:rotate-90'
                >
                  <path d='M12 5v14' />
                  <path d='M5 12h14' />
                </svg>
              </button>
            </div>
          )
        }
      </div>

      <!-- Subsection 1 -->
      <ScrollAnimation />

      <!-- Subsection 2 -->
      <ScrollViewTimelines />
    </section>
  </main>

  <Footer />

  <script>
    import { toast } from 'wc-toast'

    const $articles = document.querySelectorAll('article')
    const $animateAll: HTMLInputElement = document.querySelector('#animate')!
    const $duration: HTMLSelectElement = document.querySelector('#duration')!
    const $steps: HTMLSelectElement = document.querySelector('#steps')!
    const $delay: HTMLSelectElement = document.querySelector('#delay')!

    const $pmButtons = document.querySelectorAll('.package-manager-btn')
    const $installCommand = document.getElementById('install-command')!
    const $copyBtn = document.getElementById('copyNpmInstall')!
    const $copyCodeBtn = document.getElementById('copyCode')!

    const $versionTabs = document.querySelectorAll('.version-tab')
    const $versionCodes = document.querySelectorAll('.version-code')

    const $loadMore = document.getElementById('load-more')

    if ($loadMore) {
      $loadMore.addEventListener('click', () => {
        const $hiddenArticles = document.querySelectorAll('article.hidden')
        $hiddenArticles.forEach(($article, index) => {
          $article.classList.remove('hidden')
          // @ts-ignore
          $article.style.animationDelay = `${index * 50}ms`
        })
        $loadMore.parentElement?.remove()
      })
    }

    // Initial duration setup (if any logic depends on it)
    $duration.value = '1000ms'

    // Version Tab Switcher
    $versionTabs.forEach(($tab) => {
      $tab.addEventListener('click', () => {
        const version = $tab.getAttribute('data-version')!

        $versionTabs.forEach(($t) => {
          $t.classList.remove(
            'bg-black/10',
            'text-slate-900',
            'dark:bg-white/5',
            'dark:text-white'
          )
          $t.classList.add(
            'text-slate-500',
            'dark:text-slate-400',
            'hover:text-slate-700',
            'dark:hover:text-slate-200'
          )
        })

        $tab.classList.add(
          'bg-black/10',
          'text-slate-900',
          'dark:bg-white/5',
          'dark:text-white'
        )
        $tab.classList.remove(
          'text-slate-500',
          'dark:text-slate-400',
          'hover:text-slate-700',
          'dark:hover:text-slate-200'
        )

        $versionCodes.forEach(($code) => {
          if ($code.id === `code-${version}`) {
            $code.classList.remove('hidden')
          } else {
            $code.classList.add('hidden')
          }
        })
      })
    })

    $copyCodeBtn.addEventListener('click', () => {
      const $visibleCode = document.querySelector(
        '.version-code:not(.hidden) pre'
      )
      if ($visibleCode) {
        const text = $visibleCode.textContent!
        navigator.clipboard.writeText(text)
        toast('Configuration copied to clipboard!', {
          icon: { type: 'success' },
          theme: {
            type: document.documentElement.classList.contains('dark')
              ? 'dark'
              : 'light'
          }
        })
      }
    })

    // Package Manager Switcher
    $pmButtons.forEach(($btn) => {
      $btn.addEventListener('click', () => {
        const command = $btn.getAttribute('data-command')!
        $installCommand.textContent = command

        $pmButtons.forEach(($b) => {
          $b.classList.remove(
            'bg-black/10',
            'text-slate-900',
            'dark:bg-white/5',
            'dark:text-white'
          )
          $b.classList.add(
            'text-slate-500',
            'dark:text-slate-400',
            'hover:text-slate-700',
            'dark:hover:text-slate-200'
          )
        })

        $btn.classList.add(
          'bg-black/10',
          'text-slate-900',
          'dark:bg-white/5',
          'dark:text-white'
        )
        $btn.classList.remove(
          'text-slate-500',
          'dark:text-slate-400',
          'hover:text-slate-700',
          'dark:hover:text-slate-200'
        )
      })
    })

    $copyBtn.addEventListener('click', () => {
      const text = $installCommand.textContent!
      navigator.clipboard.writeText(text)
      toast('Command copied to clipboard!', {
        icon: { type: 'success' },
        theme: {
          type: document.documentElement.classList.contains('dark')
            ? 'dark'
            : 'light'
        }
      })
    })

    function handleMouseEnter(this: HTMLElement) {
      const animationKey = this.getAttribute('data-class')
      const animationClass = `animate-${animationKey}`
      const $box = this.querySelector('div[id^="preview-"]') as HTMLElement
      if ($box) {
        $box.classList.add(animationClass)
        // Apply current styles
        $box.style.animationDuration = $duration.value
        $box.style.animationDelay = $delay.value
        $box.style.animationTimingFunction =
          $steps.value !== 'none' ? `steps(${$steps.value})` : ''
      }
    }

    function handleMouseLeave(this: HTMLElement): void {
      const animationKey = this.getAttribute('data-class')
      const animationClass = `animate-${animationKey}`
      const $box = this.querySelector('div[id^="preview-"]')
      if ($box) $box.classList.remove(animationClass)
    }

    function updateArticlesListeners() {
      $articles.forEach(($article) => {
        if ($animateAll.checked) {
          $article.removeEventListener('mouseenter', handleMouseEnter)
          $article.removeEventListener('mouseleave', handleMouseLeave)
        } else {
          $article.addEventListener('mouseenter', handleMouseEnter)
          $article.addEventListener('mouseleave', handleMouseLeave)
        }
      })
    }

    $animateAll.addEventListener('change', () => {
      $articles.forEach(($article) => {
        const animationKey = $article.getAttribute('data-class')!
        const animationClass = `animate-${animationKey}`
        const $box = $article.querySelector(
          'div[id^="preview-"]'
        ) as HTMLElement

        if ($box) {
          if ($animateAll.checked) {
            $box.classList.add(animationClass)
            $box.style.animationIterationCount = 'infinite'
            $box.style.animationDuration = $duration.value
            $box.style.animationDelay = $delay.value
            $box.style.animationTimingFunction =
              $steps.value !== 'none' ? `steps(${$steps.value})` : ''
          } else {
            $box.classList.remove(animationClass)
            $box.style.animationIterationCount = 'unset'
          }
        }
      })
      updateArticlesListeners()
    })

    $duration.addEventListener('change', (event) => {
      const target = event.target as HTMLSelectElement
      $articles.forEach(($article) => {
        const $box = $article.querySelector(
          'div[id^="preview-"]'
        ) as HTMLElement
        if ($box) $box.style.animationDuration = target.value
      })
    })

    $steps.addEventListener('change', (event) => {
      const target = event.target as HTMLSelectElement
      $articles.forEach(($article) => {
        const $box = $article.querySelector(
          'div[id^="preview-"]'
        ) as HTMLElement
        if ($box)
          $box.style.animationTimingFunction =
            target.value !== 'none' ? `steps(${target.value})` : ''
      })
    })

    $delay.addEventListener('change', (event) => {
      const target = event.target as HTMLSelectElement
      $articles.forEach(($article) => {
        const $box = $article.querySelector(
          'div[id^="preview-"]'
        ) as HTMLElement
        if ($box) $box.style.animationDelay = target.value
      })
    })

    $articles.forEach(($article) => {
      const animationKey = $article.getAttribute('data-class')!
      const animationClass = `animate-${animationKey}`

      $article.addEventListener('mouseenter', handleMouseEnter)
      $article.addEventListener('mouseleave', handleMouseLeave)

      $article.addEventListener('click', () => {
        navigator.clipboard.writeText(animationClass)
        toast(`Copied "animate-${animationKey}"`, {
          icon: { type: 'success' },
          theme: {
            type: document.documentElement.classList.contains('dark')
              ? 'dark'
              : 'light'
          }
        })
      })
    })

    // ==========================================
    // Hero Demo Animation - Interactive Typewriter
    // ==========================================
    const $heroDemoBox = document.getElementById('hero-demo-box')
    const $heroDemoClasses = document.getElementById('hero-demo-classes')

    if ($heroDemoBox && $heroDemoClasses) {
      // Different animation configurations to showcase
      const demoAnimations = [
        { animation: 'animate-fade-in-up', extras: '' },
        { animation: 'animate-bounce', extras: 'animate-duration-700' },
        { animation: 'animate-shake', extras: 'animate-delay-100' },
        { animation: 'animate-pulse', extras: 'animate-duration-slow' },
        { animation: 'animate-swing', extras: 'animate-delay-[25ms]' },
        { animation: 'animate-wobble', extras: 'animate-duration-[777ms]' },
        { animation: 'animate-float', extras: 'animate-delay-300' },
        { animation: 'animate-zoom-in', extras: 'animate-duration-500' },
        { animation: 'animate-flip-x', extras: 'animate-duration-fast' },
        { animation: 'animate-bouncing', extras: 'animate-delay-[50ms]' },
        { animation: 'animate-heartbeat', extras: 'animate-duration-1000' },
        { animation: 'animate-jelly', extras: 'animate-delay-150' },
        {
          animation: 'animate-rubber-band',
          extras: 'animate-duration-[500ms]'
        },
        { animation: 'animate-tada', extras: 'animate-delay-200' }
      ]

      let currentDemoIndex = 0
      let isTyping = false

      // Typewriter effect function
      async function typeText(text: string): Promise<void> {
        $heroDemoClasses!.textContent = ''
        for (let i = 0; i <= text.length; i++) {
          $heroDemoClasses!.textContent = text.substring(0, i)
          await new Promise((resolve) =>
            setTimeout(resolve, 35 + Math.random() * 25)
          )
        }
      }

      // Clear text with backspace effect
      async function clearText(): Promise<void> {
        const currentText = $heroDemoClasses!.textContent || ''
        for (let i = currentText.length; i >= 0; i--) {
          $heroDemoClasses!.textContent = currentText.substring(0, i)
          await new Promise((resolve) => setTimeout(resolve, 20))
        }
      }

      // Main demo loop
      async function runDemoAnimation(): Promise<void> {
        if (isTyping) return
        isTyping = true

        const demo = demoAnimations[currentDemoIndex]
        const fullClass = demo.extras
          ? `${demo.animation} ${demo.extras}`
          : demo.animation

        // Clear previous animation class
        demoAnimations.forEach((d) => {
          const animClass = d.animation
          $heroDemoBox!.classList.remove(animClass)
        })
        $heroDemoBox!.style.animation = 'none'
        $heroDemoBox!.offsetHeight // Trigger reflow
        $heroDemoBox!.style.animation = ''

        // Type the new class
        await typeText(fullClass)

        // Apply the animation
        const animClass = demo.animation
        $heroDemoBox!.classList.add(animClass)

        // Apply extras via inline styles
        if (demo.extras.includes('duration')) {
          const match = demo.extras.match(/animate-duration-(\[?\w+ms?\]?|\w+)/)
          if (match) {
            const value = match[1]
            if (value.startsWith('[') && value.endsWith(']')) {
              $heroDemoBox!.style.animationDuration = value.slice(1, -1)
            } else if (value === 'slow') {
              $heroDemoBox!.style.animationDuration = '1500ms'
            } else if (value === 'fast') {
              $heroDemoBox!.style.animationDuration = '300ms'
            } else {
              $heroDemoBox!.style.animationDuration = value + 'ms'
            }
          }
        } else {
          $heroDemoBox!.style.animationDuration = ''
        }

        if (demo.extras.includes('delay')) {
          const match = demo.extras.match(/animate-delay-(\[?\w+ms?\]?|\w+)/)
          if (match) {
            const value = match[1]
            if (value.startsWith('[') && value.endsWith(']')) {
              $heroDemoBox!.style.animationDelay = value.slice(1, -1)
            } else {
              $heroDemoBox!.style.animationDelay = value + 'ms'
            }
          }
        } else {
          $heroDemoBox!.style.animationDelay = ''
        }

        // Wait for animation to play
        await new Promise((resolve) => setTimeout(resolve, 2500))

        // Clear and move to next
        await clearText()

        currentDemoIndex = (currentDemoIndex + 1) % demoAnimations.length
        isTyping = false

        // Continue the loop
        setTimeout(runDemoAnimation, 300)
      }

      // Start the demo
      setTimeout(runDemoAnimation, 800)
    }
  </script>

  <style>
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    pre.astro-code {
      padding: 0 !important;
      margin: 0 !important;
    }
  </style>
</Layout>
